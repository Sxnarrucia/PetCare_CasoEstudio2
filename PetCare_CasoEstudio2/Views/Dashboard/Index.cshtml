@{
    ViewBag.Title = "Dashboard de Administrador";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="mb-4"><i class="fas fa-tachometer-alt"></i> Dashboard de Administrador</h2>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3 shadow">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-calendar-day"></i> Citas de Hoy</h5>
                <h2 class="card-text text-center" id="citasHoy">--</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3 shadow">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-paw"></i> Mascotas Registradas</h5>
                <h2 class="card-text text-center" id="mascotasTotal">--</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-warning mb-3 shadow">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-check-circle"></i> Citas Realizadas Este Mes</h5>
                <h2 class="card-text text-center" id="citasMes">--</h2>
            </div>
        </div>
    </div>
</div>

<div class="card shadow">
    <div class="card-header bg-info text-white">
        <h5><i class="fas fa-user-md"></i> Top 5 Veterinarios con Más Citas Atendidas</h5>
    </div>
    <div class="card-body">
        <ol class="list-group list-group-numbered" id="topVeterinarios">
            <li class="list-group-item">Cargando...</li>
        </ol>
    </div>
</div>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function cargarDashboard() {
            $.ajax({
                url: '@Url.Action("GetDashboardData", "Dashboard")',
                method: 'GET',
                success: function (data) {
                    $("#citasHoy").text(data.citasHoy);
                    $("#mascotasTotal").text(data.mascotasTotal);
                    $("#citasMes").text(data.citasMes);
                    $("#topVeterinarios").empty();

                    if (data.topVeterinarios.length === 0) {
                        $("#topVeterinarios").append(`<li class="list-group-item">No hay datos disponibles.</li>`);
                    } else {
                        data.topVeterinarios.forEach(v => {
                            $("#topVeterinarios").append(`<li class="list-group-item">${v.Veterinario} <span class="badge bg-primary float-end">${v.Total} citas</span></li>`);
                        });
                    }
                }
            });
        }

        $(document).ready(function () {
            cargarDashboard();
            setInterval(cargarDashboard, 10000); // actualiza cada 10 segundos
        });
    </script>
}
